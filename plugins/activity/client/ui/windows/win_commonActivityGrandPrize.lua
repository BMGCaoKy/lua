---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 10184.
--- DateTime: 2020/11/23 15:48
---
local LuaTimer = T(Lib, "LuaTimer") ---@type LuaTimer

function M:init()
    WinBase.init(self, "CommonActivityGrandPrize.json")
    self:initWnd()
    self:initEvent()
end

function M:initWnd()
    self.stName = self:child("CommonActivityGrandPrize-item_name")
    self.stTip = self:child("CommonActivityGrandPrize-tip")
    self.siIcon = self:child("CommonActivityGrandPrize-item")
    self.siEffect2 = self:child("CommonActivityGrandPrize-effect2")
    self.siEffect3 = self:child("CommonActivityGrandPrize-effect3")
    self.btnSure = self:child("CommonActivityGrandPrize-sure")
    self.btnSure:SetText(Lang:getMessage("common.activity.sure"))
    self.stRibbon = self:child("CommonActivityGrandPrize-ribbon_text")
    self.fun = nil
end

function M:initEvent()
    self:subscribe(self.btnSure, UIEvent.EventButtonClick, function()
        self:onClick()
    end)
    self:subscribe(self:root(), UIEvent.EventWindowClick, function()
        self:onClick()
    end)
end

function M:initReward(reward, fun)
    self.stName:SetText(Lang:getMessage(reward.name))
    self.siIcon:SetImage(reward.image)

    self.btnSure:SetYPosition({ 0, 460 })
    self.stTip:SetText("")
    self.stRibbon:SetText(Lang:getMessage("common.activity.tip.completed"))

    self.reward = reward

    self.fun = fun
    UI:openWnd("commonActivityGrandPrize")
end

function M:removeCallBack()
    self.fun = nil
end

function M:onClick()
    UI:closeWnd("commonActivityGrandPrize")
    if self.fun then
        self.fun()
    end
end

function M:onOpen()
    self.siEffect2:SetEffectName("g1008_treasure_02.effect")
    self.siEffect3:SetEffectName("g1008_treasure_03.effect")
    self.btnSure:SetTouchable(false)
    self.canClose = false
    LuaTimer:schedule(function()
        self.btnSure:SetTouchable(true)
        self.canClose = true
    end, 1700)
end