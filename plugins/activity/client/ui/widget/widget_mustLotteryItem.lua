---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 10184.
--- DateTime: 2020/11/18 10:21
---
local widget_base = require "ui.widget.widget_base"
local M = Lib.derive(widget_base)

function M:init(parent)
    widget_base.init(self, "MustLotteryItem.json")
    self.parent = parent
    self:initWnd()
    self:initEvent()
end

function M:initWnd()
    self.llRoot = self:root()
    self.ivImage = self:child("MustLotteryItem-Image")
    self.tvCount = self:child("MustLotteryItem-Count")
    self.ivImageMask = self:child("MustLotteryItem-Image-Mask")
    self.ivSelected = self:child("MustLotteryItem-Selected")
    self.btnSelected = self:child("MustLotteryItem-Selected-Click")
    self.llMask = self:child("MustLotteryItem-Mask")
    self.ivMaskIcon = self:child("MustLotteryItem-Mask-Icon")
    self.ivEffect = self:child("MustLotteryItem-Effect")
    self.ivEffectMask = self:child("MustLotteryItem-Effect-Mask")
    self.llMask:SetVisible(false)
    self:setEffect(false)
    self.ivEffectMask:SetImage("set:common_activity.json image:img_9_mask_must")
end

function M:initEvent()
    self:subscribe(self.llRoot, UIEvent.EventWindowClick, function()
        self.parent:clickItem(self)
    end)
    self:subscribe(self.btnSelected, UIEvent.EventButtonClick, function()
        self.parent:selectItem(self)
    end)
end

function M:onDataChanged(data)
    self.isGrandPrize = data.isGrandPrize
    self.groupSeq = data.groupSeq
    self.reward = data.reward

    self:SetIcon(self.reward)
    if self.reward.needMask then
        self.ivImageMask:SetImage("set:common_activity.json image:img_iconboard_" .. self.reward.quality .. "_mask")
        self.ivImageMask:SetVisible(true)
    end

    if self.reward.numLang ~= "#" then
        self.tvCount:SetText(Lang:getMessage(self.reward.numLang))
    end
    self.llRoot:SetBackImage("set:common_activity.json image:img_iconboard_" .. data.reward.quality)
    if self.isGrandPrize then
        self.ivSelected:SetVisible(false)
    end
end

function M:setSelected(selected)
    if selected then
        self.ivSelected:SetImage("set:common_activity.json image:chb_0_selected")
    else
        self.ivSelected:SetImage("set:common_activity.json image:chb_0_normal")
    end
end

---设置成被删除
function M:setDelete(deleted)
    self.ivSelected:SetVisible(false)
    self.llMask:SetVisible(deleted)
    if deleted then
        self.ivMaskIcon:SetImage("set:common_activity.json image:img_0_item_remove")
        self.ivMaskIcon:SetWidth({ 0, 24 })
        self.ivMaskIcon:SetHeight({ 0, 23 })
    else
        if self.isGet then
            self:setGet()
        end
    end
end

---设置成已获得
function M:setGet()
    self.isGet = true
    self.llMask:SetVisible(true)
    self.ivMaskIcon:SetImage("set:common_activity.json image:img_0_item_get")
    self.ivMaskIcon:SetWidth({ 0, 29 })
    self.ivMaskIcon:SetHeight({ 0, 21 })
    self.ivEffect:SetVisible(false)
end

function M:setEffect(effect)
    self.ivEffect:SetVisible(effect)
end

function M:SetIcon(data)
    if data.imageScale ~= "#" then
        UILib:setImageAdjustSize(self.ivImage, data.image, self.ivImage:GetPixelSize().x, self.ivImage:GetPixelSize().y, data.imageScale)
    else
        UILib:setImageAdjustSize(self.ivImage, data.image)
    end
    if data.imageXOffset ~= "#" then
        self.ivImage:SetXPosition({ 0, data.imageXOffset })
    end
    if data.imageYOffset ~= "#" then
        self.ivImage:SetYPosition({ 0, data.imageYOffset })
    end
end

return M