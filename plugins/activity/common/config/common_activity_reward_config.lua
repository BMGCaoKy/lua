---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2020/11/17 16:01
---

local CommonActivityRewardConfig = T(Config, "CommonActivityRewardConfig") ---@class CommonActivityRewardConfig

local Rewards = {}
local RewardGroups = {}

local function initRewardItemConfig(config)
    for _, item in pairs(config) do
        local data = {}
        data.rewardId = tonumber(item.id)                                   ---奖励id
        data.realId = item.realId                                           ---真实奖励id
        data.type = item.type                                               ---奖励类型
        data.quality = item.quality                                         ---物品品质
        data.effect = item.effect                                           ---特效名称
        data.num = tonumber(item.num)                                       ---物品数量
        data.numLang = item.numLang                                         ---物品数量多语言
        data.name = item.name                                               ---物品名
        data.image = item.image                                             ---图片
        data.imageScale = tonumber(item.imageScale) or "#"                  ---图片缩放
        data.imageXOffset = tonumber(item.imageXOffset) or 0                ---图片X方向偏移值
        data.imageYOffset = tonumber(item.imageYOffset) or 0                ---图片Y方向偏移值
        data.needMask = tonumber(item.needMask) == 1                        ---是否遮罩
        data.desc = item.desc                                               ---物品详情
        data.price = tonumber(item.price)                                   ---价格
        data.priceIcon = item.priceIcon                                     ---价格图片
        data.compensate = tonumber(item.compensate) or 0                    ---补偿物品
        Rewards[item.id] = data
    end
end

local function initRewardGroupConfig(config)
    for _, item in pairs(config) do
        local group = RewardGroups[tostring(item.groupId)] or {}
        local reward = Rewards[item.rewardId]
        if reward then
            table.insert(group, {
                reward = reward,
                groupSeq = tonumber(item.groupSeq), ---排序
                weights = tonumber(item.weights), ---权重
                isGrandPrize = item.isGrandPrize == "1", ---是否为大奖
            })
        end
        RewardGroups[tostring(item.groupId)] = group
    end
    for _, group in pairs(RewardGroups) do
        table.sort(group, function(a, b)
            return a.groupSeq < b.groupSeq
        end)
    end
end

local function init()
    Rewards = {}
    RewardGroups = {}
    local config = Lib.read_csv_file(Root.Instance():getGamePath() .. "config/common/CommonActivityRewardItem.csv", 3) or {}
    initRewardItemConfig(config)
    config = Lib.read_csv_file(Root.Instance():getGamePath() .. "config/common/CommonActivityRewardGroup.csv", 3) or {}
    initRewardGroupConfig(config)
end

function CommonActivityRewardConfig:getRewardGroupById(groupId)
    return RewardGroups[tostring(groupId)]
end

function CommonActivityRewardConfig:getRewardById(rewardId)
    return Rewards[tostring(rewardId)]
end

init()
